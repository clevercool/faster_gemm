#! /bin/bash

# VGG16 BS=16
declare -a metrics=(
    "64 824464 27"
    "64 824464 576"
    "128 207936 576"
    "128 207936 1152"
    "256 51984 1152"
    "256 51984 2304"
    "256 51984 2304"
    "512 13456 2304"
    "512 13456 4608"
    "512 13456 4608"
    "512 3600 4608"
    "512 3600 4608"
    "512 3600 4608"
    "16 4096 32768"
    "16 4096 4096"
    "16 12 4096"
)

# VGG16 BS=8
declare -a metrics_a=(
    "64 412232 27"
    "64 412232 576"
    "128 103968 576"
    "128 103968 1152"
    "256 25992 1152"
    "256 25992 2304"
    "256 25992 2304"
    "512 6728 2304"
    "512 6728 4608"
    "512 6728 4608"
    "512 1800 4608"
    "512 1800 4608"
    "512 1800 4608"
    "8 4096 32768"
    "8 4096 4096"
    "8 12 4096"
)

# VGG16 BS=4
declare -a metrics_a=(
    "64 206116 27"
    "64 206116 576"
    "128 51984 576"
    "128 51984 1152"
    "256 12996 1152"
    "256 12996 2304"
    "256 12996 2304"
    "512 3364 2304"
    "512 3364 4608"
    "512 3364 4608"
    "512 900 4608"
    "512 900 4608"
    "512 900 4608"
    "4 4096 32768"
    "4 4096 4096"
    "4 12 4096"
)

# VGG16 BS=2
declare -a metrics_a=(
    "64 103058 27"
    "64 103058 576"
    "128 25992 576"
    "128 25992 1152"
    "256 6498 1152"
    "256 6498 2304"
    "256 6498 2304"
    "512 1682 2304"
    "512 1682 4608"
    "512 1682 4608"
    "512 450 4608"
    "512 450 4608"
    "512 450 4608"
    "2 4096 32768"
    "2 4096 4096"
    "2 12 4096"
)

# Resnet32 BS=32
declare -a metrics_a=(
    "64 200704 49"
    "64 50176 576"
    "64 50176 576"
    "64 50176 576"
    "64 50176 576"
    "64 50176 576"
    "128 50176 576"
    "128 12544 1152"
    "128 12544 1152"
    "128 12544 1152"
    "128 12544 1152"
    "128 12544 1152"
    "128 12544 1152"
    "128 12544 1152"
    "256 12544 1152"
    "256 3136 2304"
    "256 3136 2304"
    "256 3136 2304"
    "256 3136 2304"
    "256 3136 2304"
    "256 3136 2304"
    "256 3136 2304"
    "256 3136 2304"
    "256 3136 2304"
    "256 3136 2304"
    "256 3136 2304"
    "512 3136 2304"
    "512 784 4608"
    "512 784 4608"
    "512 784 4608"
    "512 784 4608"
    "512 784 4608"
    "512 784 4608"
    "32 1000 20736"
)

for metric_t in "${metrics[@]}"
do
    echo "./tzgemm_out 1 1000 $metric_t"
    ./tzgemm_out 1 1000 $metric_t >> log_ori_tzgemm
    sleep 3
done

echo '-------------------------------------------------' >> log_ori_tzgemm
cat log_ori_tzgemm | grep 'cublas took' | awk '{print $3}' >> log_ori_tzgemm
echo '-------------------------------------------------' >> log_ori_tzgemm
cat log_ori_tzgemm | grep 'tzgemm took' | awk '{print $3}' >> log_ori_tzgemm


# for metric_t in "${metrics[@]}"
# do
#     echo "./tzgemm_out 2 1000 $metric_t"
#     ./tzgemm_out 2 1000 $metric_t >> log_128_tzgemm
#     sleep 3
# done

# echo '-------------------------------------------------' >> log_128_tzgemm
# cat log_128_tzgemm | grep 'cublas took' | awk '{print $3}' >> log_128_tzgemm
# echo '-------------------------------------------------' >> log_128_tzgemm
# cat log_128_tzgemm | grep 'tzgemm took' | awk '{print $3}' >> log_128_tzgemm


# for metric_t in "${metrics[@]}"
# do
#     echo "./txgemm_out 2 1000 $metric_t"
#     ./txgemm_out 2 1000 $metric_t >> log_64_txgemm
#     sleep 3
# done

# echo '-------------------------------------------------' >> log_64_txgemm
# cat log_64_txgemm | grep 'cublas took' | awk '{print $3}' >> log_64_txgemm
# echo '-------------------------------------------------' >> log_64_txgemm
# cat log_64_txgemm | grep 'tzgemm took' | awk '{print $3}' >> log_64_txgemm


# for metric_t in "${metrics[@]}"
# do
#     echo "./txgemm_out 4 1000 $metric_t"
#     ./txgemm_out 4 1000 $metric_t >> log_64_txgemm_4 
#     sleep 3
# done

# echo '-------------------------------------------------' >> log_64_txgemm_4
# cat log_64_txgemm_4 | grep 'cublas took' | awk '{print $3}' >> log_64_txgemm_4
# echo '-------------------------------------------------' >> log_64_txgemm_4
# cat log_64_txgemm_4 | grep 'tzgemm took' | awk '{print $3}' >> log_64_txgemm_4
